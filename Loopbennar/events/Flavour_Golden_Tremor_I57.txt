################################################
##           Creator: Blaziy	         	  ##
##			  Writer: ______				  ##
################################################

namespace = golden_tremor_events

country_event = { #And They Drown In Sin
	id = golden_tremor_events.1
	title = golden_tremor_events.1.t
	desc = golden_tremor_events.1.desc
	picture = DISCIPLINED_SOLDIERS_eventPicture

	is_triggered_only = yes
	
	immediate = {
		hidden_effect = {
			random_owned_province = {
				limit = { has_ruler_leader_from = ROOT }
				save_global_event_target_as = I57_negeal_target
			}
			set_variable = {
				which = golden_tremor_won_negeal_var
				value = 0
			}
		}
	}

	option = {
		name = golden_tremor_events.1.a
		custom_tooltip = I57_buff_free_clans_tt
		set_country_flag = I57_buff_free_clans_flag

		custom_tooltip = I57_enable_negeal_button_tt
		set_country_flag = I57_enable_negeal_button_flag

		event_target:I57_negeal_target = {
			area = {
				spawn_rebels = {
					size = 1
					type = pretender_rebels
				}
				add_local_autonomy = 25
				add_nationalism = 5
			}
			FROM = { set_country_flag = I57_challenging_to_negeal_lvl_1_flag }
			custom_tooltip = I57_challenging_to_negeal_win_lvl_1_tt
		}
		custom_tooltip = I57_ordsiwyn_warning_tt
	}
}

country_event = { #Ordsiwyn Leaves
	id = golden_tremor_events.2
	title = golden_tremor_events.2.t
	desc = golden_tremor_events.2.desc
	picture = MARCHING_PEASANTS_eventPicture

	is_triggered_only = yes

	trigger = {
		mission_completed = I57_5_1_weigh_their_hearts
		NOT = { mission_completed = I57_4_5_the_enchained_clans }
		OR = {
			AND = {
				mission_completed = I57_5_3_ordsiwyn_reforms
				had_country_flag = {
					flag = I57_ordsiwyn_leave_timer_flag
					days = 1825 #5 years
				}
			}
			AND = {
				NOT = { mission_completed = I57_5_3_ordsiwyn_reforms }
				had_country_flag = {
					flag = I57_ordsiwyn_leave_timer_flag
					days = 730 #2 years
				}
			}
		}
	}

	immediate = {
		set_country_flag = I57_ordsiwyn_leave_timer_flag
		hidden_effect = {
			random_owned_province = {
				limit = { 
					NOT = { has_province_flag = I57_won_negeal_flag } 
					culture_is_centaur = yes
					religion = irdaeos_worship
				}
				save_event_target_as = I57_ordsiwyn_leave_prov
			}
		}
	}

	option = {
		name = golden_tremor_events.2.a
		trigger = { has_saved_event_target = I57_ordsiwyn_leave_prov }
		goto = I57_ordsiwyn_leave_prov
		event_target:I57_ordsiwyn_leave_prov = {
			area = {
				custom_tooltip = I57_lose_random_development_tt
				hidden_effect = {
					random_area_province = { remove_random_development = yes }
					random_area_province = { remove_random_development = yes }
					random_area_province = { remove_random_development = yes }
					random_area_province = { remove_random_development = yes }
					random_area_province = { remove_random_development = yes }
					set_province_flag = I57_ordsiwyn_leave_prov_flag
				}
			}
		}
		add_horde_unity = -10
		custom_tooltip = I57_ordsiwyn_leave_explain_tt
	}

	option = {
		name = golden_tremor_events.2.b
		trigger = { 
			custom_trigger_tooltip = {
				tooltip = I57_ordsiwyn_leave_prov_tt
				NOT = { has_saved_event_target = I57_ordsiwyn_leave_prov }
			}
		}
		highlight = yes
		add_horde_unity = 10
		add_prestige_or_monarch_power = { amount = 10 } #Error is lies
	}
}

country_event = { #The Meek Breeze
	id = golden_tremor_events.3
	title = golden_tremor_events.3.t
	desc = golden_tremor_events.3.desc
	picture = CENTAUR_CAMPFIRE_eventPicture

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			white_peace = I78 #Wild Hunt
		}
	}

	option = {
		name = golden_tremor_events.3.a

		tooltip = { white_peace = I78 } #Wild Hunt
		custom_tooltip = I57_annex_wild_hunt_tt
		hidden_effect = {
			yyl_moista_region = {
				limit = { owned_by = I78 } #Wild Hunt
				cede_province = ROOT
			}
			west_forbidden_plains_region = {
				limit = { owned_by = I78 } #Wild Hunt
				cede_province = ROOT
			}
			add_or_extend_country_modifier_indefinitely = {
				name = I57_the_drums_of_reformation
				duration = 3650 #10 years
			}
		}

		if = {
			limit = { I67 = { has_20_opinion_sent_gift = { target = ROOT } } } #Endless Arrows
			domn_filaenan_area = {
				limit = { owned_by = I78 } #Wild Hunt
				cede_province = I67 #Endless Arrows
			}
			orchekh_area = {
				limit = { owned_by = I78 } #Wild Hunt
				cede_province = I67 #Endless Arrows
			}
			if = {
				limit = { I67 = { ai = yes } } #Endless Arrows
				vassalize = I67 #Endless Arrows
			}
			else = {
				I67 = { every_owned_province = { ROOT = { add_permanent_claim = PREV } } } #Endless Arrows
			}
		}

		if = {
			limit = { I74 = { has_20_opinion_sent_gift = { target = ROOT } } } #Bloodbringer
			if = {
				limit = { 5149 = { owned_by = I78 } } #Faanhosegh, Wild Hunt
				5149 = { cede_province = I74 } #Faanhosegh, Bloodbringer
			}
			if = {
				limit = { I74 = { ai = yes } } #Bloodbringer
				vassalize = I74 #Bloodbringer
			}
			else = {
				I74 = { every_owned_province = { ROOT = { add_permanent_claim = PREV } } } #Bloodbringer
			}
		}

		if = {
			limit = { I72 = { has_20_opinion_sent_gift = { target = ROOT } } } #City Razer
			if = {
				limit = { I72 = { ai = yes } } #City Razer
				vassalize = I72 #City Razer
			}
			else = {
				I72 = { every_owned_province = { ROOT = { add_permanent_claim = PREV } } } #City Razer
			}
		}
	}
}

country_event = { #The Gleaming Caehn/Horde
	id = golden_tremor_events.4
	title = golden_tremor_events.4.t
	desc = golden_tremor_events.4.desc
	picture = BYZ_GOOD_WITH_MONARCH_eventPicture

	is_triggered_only = yes

	option = {
		name = golden_tremor_events.4.a
		change_government_reform_progress = 25
		set_country_flag = I57_nzoc_effects_flag
		custom_tooltip = I57_nzoc_effects_tt
		remove_country_modifier = I57_the_drums_of_reformation

		if = {
			limit = { has_ruler_flag = I57_is_rhidrin_flag }
			custom_tooltip = I57_rhidrin_ruler_tt
			hidden_effect = {
				add_ruler_modifier = {
					name = I57_the_drums_of_reformation
					duration = -1
				}
			}
		}
		else_if = {
			limit = { has_ruler_flag = I57_is_baildelk_flag }
			custom_tooltip = I57_baildelk_ruler_tt
			hidden_effect = {
				add_ruler_modifier = {
					name = I57_the_drums_of_reformation
					duration = 3650 #10 years
				}
			}
		}
	}
}

province_event = { #Baildelk's Call
	id = golden_tremor_events.5
	title = golden_tremor_events.5.t
	desc = golden_tremor_events.5.desc
	picture = indiangfx_ECONOMY_eventPicture

	is_triggered_only = yes

	option = {
		name = golden_tremor_events.5.a
		change_trade_goods = gold
		add_province_modifier = {
			name = I57_tarnished_veins
			duration = -1
		}
		custom_tooltip = I57_deving_capital_tt
		hidden_effect = { owner = { set_country_flag = I57_deving_capital_flag } }
	}
}

country_event = { #The Greatest Negeal
	id = golden_tremor_events.6
	title = golden_tremor_events.6.t
	desc = golden_tremor_events.6.desc
	picture = MAMLUK_WARRIORS_eventPicture
	fire_only_once = yes

	is_triggered_only = yes

	trigger = {
		NOT = { num_of_rebel_armies = 1 } 
	}

	option = {
		name = golden_tremor_events.6.a
		
		custom_tooltip = I57_upgrade_negeal_button_tt
		custom_tooltip = I57_enchained_clans_win_tt
		hidden_effect = {
			set_country_flag = I57_enabled_stronger_negeal_flag
			clr_country_flag = I57_enchained_rebels_flag
			every_owned_province = {
				limit = { I57_won_negeal = yes }
				add_local_autonomy = -100
				cavalry = owner
				cavalry = owner
				add_province_modifier = {
					name = I57_defeated_in_negeal
					duration = -1
				}
				remove_province_modifier = I57_defeated_in_negeal_small
			}
		}
	}
}

country_event = { #The Golden Codex
	id = golden_tremor_events.7
	title = golden_tremor_events.7.t
	desc = golden_tremor_events.7.desc
	picture = DECLARATION_INDEPENDENCE_eventPicture

	is_triggered_only = yes

	option = {
		name = golden_tremor_events.7.a
		custom_tooltip = I57_lose_mission_effects_tt
		remove_country_modifier = I57_ogre_auxilieries
		add_country_modifier = {
			name = I57_the_golden_codex_mod
			duration = -1
		}
		form_lejdazamh_effects = yes
		clr_country_flag = I57_gilded_hooves_flag
		clr_country_flag = I57_nzoc_effects_flag
	}
}

country_event = { #The Golden Call Falls Silent
	id = golden_tremor_events.10
	title = golden_tremor_events.10.t
	desc = golden_tremor_events.10.desc
	picture = KING_SICK_IN_BED_eventPicture

	is_triggered_only = yes
	fire_only_once = yes

	trigger = {
		is_or_was_tag = { tag = I57 } #Golden Tremor
		NOT = { has_ruler_flag = I57_is_rhidrin_flag }
	}

	option = {
		name = golden_tremor_events.10.a
		trigger = { NOT = { mission_completed = I57_3_6_the_golden_codex } }
		custom_tooltip = I57_ruler_dead_revolt_tt
		tooltip = {
			capital_scope = {
				spawn_rebels = {
					size = 1
					type = pretender_rebels
				}
			}
		}

		if = {
			limit = { mission_completed = I57_3_3_rise_of_the_golden_caehn }
			custom_tooltip = I57_ruler_dead_help_yes_tt
			hidden_effect = {
				every_owned_province = {
					limit = { I57_won_negeal = yes }
					random = {
						chance = 50
						spawn_rebels = {
							size = 1
							type = pretender_rebels
						}
					}
				}
			}
		}
		else = {
			custom_tooltip = I57_ruler_dead_help_no_tt
			hidden_effect = {
				every_owned_province = {
					limit = { I57_won_negeal = yes }
					spawn_rebels = {
						size = 1
						type = pretender_rebels
					}
				}
			}
		}

		if = {
			limit = { mission_completed = I57_1_3_sweet_riverspeak }
			custom_tooltip = I57_consort_mission_done_yes_tt
		}
		else = {
			custom_tooltip = I57_consort_mission_done_no_tt
			hidden_effect = {
				every_subject_country = {
					add_liberty_desire = 20
				}
			}
		}
	}
	
	option = {
		name = golden_tremor_events.10.b
		trigger = { mission_completed = I57_3_6_the_golden_codex }
		highlight = yes
		add_splendor = 800
		add_stability = 1
	}
}

country_event = { #Negeal Win Event
	id = golden_tremor_events.20
	title = golden_tremor_events.20.t
	desc = golden_tremor_events.20.desc
	picture = MONGOL_BANNERS_eventPicture
	goto = I57_negeal_target

	is_triggered_only = yes

	trigger = {
		NOT = { num_of_rebel_armies = 1 }
	}

	option = {
		name = golden_tremor_events.20.a
		if = {
			limit = { has_country_flag = I57_enabled_stronger_negeal_flag }
			event_target:I57_negeal_target = {
				area = {
					add_local_autonomy = -100
					if = {
						limit = { ROOT = { army_size_percentage = 1 } }
						ROOT = { add_manpower = 0.75 }
					}
					else = { cavalry = owner }
					if = {
						limit = { ROOT = { army_size_percentage = 1 } }
						ROOT = { add_manpower = 0.75 }
					}
					else = { cavalry = owner }
					add_province_modifier = {
						name = I57_defeated_in_negeal
						duration = -1
					}
					set_province_flag = I57_won_negeal_flag
				}
			}
		}
		else = {
			event_target:I57_negeal_target = {
				area = {
					add_local_autonomy = -50
					tooltip = { add_unrest = -5 }
					add_nationalism = -15
					if = {
						limit = { ROOT = { army_size_percentage = 1 } }
						ROOT = { add_manpower = 0.75 }
					}
					else = { cavalry = owner }
					set_province_flag = I57_won_negeal_flag
					hidden_effect = {
						add_province_modifier = {
							name = I57_defeated_in_negeal_small
							duration = 18250 #50 years
						}
					}
				}
			}
		}
		if = {
			limit = {
				event_target:I57_negeal_target = {
					area_for_scope_province = {
						has_province_flag = I57_ordsiwyn_leave_prov_flag
					}
				}
			}
			event_target:I57_ordsiwyn_leave_prov = {
				area = {
					custom_tooltip = I57_gain_random_development_tt
					hidden_effect = {
						random_area_province = { add_random_development = 1 }
						random_area_province = { add_random_development = 1 }
						random_area_province = { add_random_development = 1 }
					}
				}
			}
		}
		hidden_effect = {
			clr_country_flag = I57_challenging_to_negeal_lvl_1_flag 
			clr_country_flag = I57_challenging_to_negeal_lvl_2_flag 
			change_variable = {
				which = golden_tremor_won_negeal_var
				value = 1
			}
		}
	}
}

country_event = { #Negeal Lose Event
	id = golden_tremor_events.21
	title = golden_tremor_events.21.t
	desc = golden_tremor_events.21.desc
	picture = IMPALED_SOLDIERS_eventPicture
	goto = I57_negeal_target

	is_triggered_only = yes

	option = {
		name = golden_tremor_events.21.a
		if = {
			limit = { has_country_flag = I57_enabled_stronger_negeal_flag }
			custom_tooltip = I57_challenging_to_negeal_lose_lvl_2_tt
		}
		else = { custom_tooltip = I57_challenging_to_negeal_lose_lvl_1_tt }
		event_target:I57_negeal_target = { 
			area = { set_province_flag = I57_failed_negeal_flag } 
		}
		clr_country_flag = I57_challenging_to_negeal_lvl_1_flag 
		clr_country_flag = I57_challenging_to_negeal_lvl_2_flag 
	}
}

country_event = { #Negeal Check Rebels Event
	id = golden_tremor_events.22
	title = none
	desc = none
	picture = none
	hidden = yes
	is_triggered_only = yes

	trigger = {
		is_or_was_tag = { tag = I57 } #Golden Tremor
		OR = { 
			has_country_flag = I57_challenging_to_negeal_lvl_1_flag 
			has_country_flag = I57_challenging_to_negeal_lvl_2_flag 
			has_country_flag = I57_enchained_rebels_flag
		}
		NOT = { num_of_rebel_armies = 1 }
	}

	option = {
		name = none
		if = {
			limit = { has_country_flag = I57_enchained_rebels_flag }
			country_event = { #The Greatest Negeal
				id = golden_tremor_events.6
			}
		}
		else = {
			country_event = { #Negeal Win Event
				id = golden_tremor_events.20
			}
		}
	}
}
